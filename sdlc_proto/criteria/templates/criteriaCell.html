{% load common_tags %}

<td
        {% if node.leafCount > 0 %}
            rowspan="{{ node.leafCount }}"
        {% elif node.depth < treeHeight %}
            colspan="{{ treeHeight|sub:node.depth|add:1 }}"
        {% endif %}

        {% if node.isSelfScore %}
            class="overall"
        {% endif %}
>
    <div class="cell-container" id="criteriaCell{{ node.criteria.pk }}">
        {% if not node.isSelfScore %}
            <span class="name">{{ node.criteria.name }}</span>
            [{{ node.criteria.pk }}]
            <span class="benefits-score">B{{ node.criteria.benefits }} </span>
            <span class="hurts-score">H{{ node.criteria.hurts }}</span>
        {% endif %}
    </div>
    <div class="ui flowing popup criteria-detail-popup" id="criteriaPopup{{ node.criteria.pk }}">
        {% include 'criteriaDetail.html' with criteria=node.criteria %}
    </div>
</td>

{% if node.leafCount == 0 %}
    {% for tool in tools %}
        {% with givenScore=node.scores|dictLookup:tool.pk|getField:'score' givenNotes=node.scores|dictLookup:tool.pk|getField:'notes' %}
            <td>
                <div class="score-container" id="scoreCellC{{ node.criteria.pk }}T{{ tool.pk }}" {% if not givenScore %}
                     style="background: red"{% endif %}>
                    <span class="score">{% if givenScore %} {{ givenScore }} {% else %} Not Scored {% endif %}</span>
                </div>
                <div class="ui flowing popup score-detail-popup" id="scorePopupC{{ node.criteria.pk }}T{{ tool.pk }}">
                    {% if givenScore %}
                        {% include 'scoreDetail.html' with criteria=node.criteria tool=tool initialScore=givenScore initialNotes=givenNotes %}
                    {% else %}
                        {% include 'scoreDetail.html' with criteria=node.criteria tool=tool initialScore=0 initialNotes='' %}
                    {% endif %}
                </div>
            </td>
        {% endwith %}
    {% endfor %}
{% endif %}
